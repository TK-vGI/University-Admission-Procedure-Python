DEPT_SCORE_INDICES = {
    "Biotech": [1, 2],
    "Chemistry": [2],
    "Engineering": [3, 4],
    "Mathematics": [3],
    "Physics": [1, 3]
}


def print_output(departments: dict, to_file=True) -> None:
    if not to_file:
        for dept in sorted(departments.keys()):
            print(dept)
            for applicant in departments[dept]:
                score = compute_score(applicant, dept)
                print(f"{applicant[0]} {score:.1f}")
            print()
    else:
        for dept in departments:
            with open(f"{dept.lower()}.txt", "w", encoding="utf-8") as f:
                for applicant in departments[dept]:
                    score = compute_score(applicant, dept)
                    f.write(f"{applicant[0]} {score:.1f}\n")


def process_file(filename: str) -> list:
    """
    Process "applicant_list.txt" file,
    example: "John Ritchie 89 45 83 75 Physics Engineering Mathematics"
    parsing: [0,1] name,
             [2,3,4,5] physics_score, chemistry_score, math_score, computer_science_score,
             [6,7,8] priority_a, priority_b, priority_c
    """
    # Read the applicants.txt file, example: "John Ritchie 89 45 83 75 Physics Engineering Mathematics"
    with open(filename, "r", encoding="utf-8") as fd:
        return [
            [" ".join(parts[0:2])] + list(map(float, parts[2:6])) + parts[6:]
            for line in fd
            if (parts := line.strip().split())
        ]


def sort_applicants_by_score(applicants: list, dept: str) -> list:
    return sorted(applicants, key=lambda x: (-compute_score(x, dept), x[0]))


def compute_score(applicant: list, dept: str) -> float:
    indices = DEPT_SCORE_INDICES[dept]
    scores = [applicant[index] for index in indices]
    return sum(scores) / len(scores)


def sort_by_department(applicants: list, departments: dict, n: int) -> dict | None:
    """
    applicants parsing: [name,
                        physics_score, chemistry_score, math_score, computer_science_score,
                        priority_a, priority_b, priority_c]
    """
    # Track applicants who have already been admitted
    admitted = set()

    # Round indices for priority departments
    priorities = [5, 6, 7]  # first, second, third priority

    for priority in priorities:
        for dept in departments:
            # Only consider applicants who are not admitted yet
            eligible = [
                applicant for applicant in applicants
                if applicant[priority] == dept and tuple(applicant) not in admitted
            ]

            selected = sort_applicants_by_score(eligible, dept)[:n - len(departments[dept])]

            departments[dept].extend(selected)
            admitted.update(map(tuple, selected))

    # Re-sort each department's final list before returning
    for dept in departments:
        departments[dept] = sort_applicants_by_score(departments[dept], dept)

    return departments


def main():
    departments = {dept: [] for dept in DEPT_SCORE_INDICES.keys()}

    # Process "applicant_list.txt" file,
    # applicants = process_file(filename="applicants2_list_6_examples.txt")
    applicants = process_file(filename="applicant_list_6.txt")

    # N integer representing the number of applicants allowed for department
    n = int(input())

    # Sort list of applicant by Departments
    departments = sort_by_department(applicants, departments, n)

    # Output result according to score
    # print_output(departments, to_file=False)  # print output to screen
    print_output(departments, to_file=True) # print output to files "%department_name%.txt"


if __name__ == '__main__':
    main()